@page
@model AccessManager.Pages.Roles.IndexModel
@{
    ViewData["Title"] = "Roller ve Yetkiler";
}

<h1 class="mb-4">Roller ve Yetkiler</h1>

<div class="accordion" id="rolesAccordion">
    @foreach (var role in Model.Roles)
    {
        var details = Model.RolePermissionDetails.TryGetValue(role.Id, out var d) ? d : new List<(string, string)>();
        var id = "role-" + role.Id.ToString("N")[..8];
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#@id">
                    @role.Name @if (!string.IsNullOrEmpty(role.Code)) { <span class="text-muted ms-2">(@role.Code)</span> }
                </button>
            </h2>
            <div id="@id" class="accordion-collapse collapse" data-bs-parent="#rolesAccordion">
                <div class="accordion-body">
                    @if (role.Description != null) { <p class="text-muted">@role.Description</p> }
                    <p class="mb-2"><strong>Varsayılan yetkiler (işe girişte atanır):</strong></p>
                    <ul class="list-group list-group-flush">
                        @foreach (var (sysName, perm) in details)
                        {
                            <li class="list-group-item">@sysName — @perm</li>
                        }
                    </ul>
                    @if (!details.Any()) { <p class="text-muted mb-0">Tanımlı yetki yok.</p> }
                </div>
            </div>
        </div>
    }
</div>
