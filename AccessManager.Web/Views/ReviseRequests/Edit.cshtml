@model AccessManager.UI.ViewModels.ReviseRequestEditInputModel
@using AccessManager.Domain.Enums
@using AccessManager.UI.Helpers
@{
    ViewData["Title"] = "Talep Düzenle";
    var request = ViewBag.Request as AccessManager.Domain.Entities.ReviseRequest;
}

@if (request == null)
{
    <div class="alert alert-danger">Talep bulunamadı.</div>
    return;
}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-controller="ReviseRequests" asp-action="Index" style="color: inherit; text-decoration: none;">Geliştiriciden Talepler</a></li>
        <li class="breadcrumb-item"><a asp-action="Detail" asp-route-id="@request.Id" style="color: inherit; text-decoration: none;">@request.Title</a></li>
        <li class="breadcrumb-item active">Düzenle</li>
    </ol>
</nav>

<div class="am-card am-card--narrow">
    <div class="am-card-body">
        <form method="post" asp-action="Edit" enctype="multipart/form-data">
            <input type="hidden" asp-for="Id" />
            <div asp-validation-summary="ModelOnly" class="text-danger small mb-3"></div>

            <div class="mb-3">
                <label asp-for="Title" class="form-label">Başlık <span class="text-danger">*</span></label>
                <input asp-for="Title" class="form-control" required maxlength="500" />
                <span asp-validation-for="Title" class="text-danger small"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Description" class="form-label">Açıklama <span class="text-danger">*</span></label>
                <textarea asp-for="Description" class="form-control" rows="5" required></textarea>
                <span asp-validation-for="Description" class="text-danger small"></span>
            </div>

            @if (request.Images.Any())
            {
                <div class="mb-3">
                    <label class="form-label">Mevcut Fotoğraflar</label>
                    <div class="row g-2">
                        @foreach (var image in request.Images.OrderBy(i => i.DisplayOrder))
                        {
                            <div class="col-md-3 col-sm-4 col-6">
                                <div class="position-relative">
                                    <input type="checkbox" name="ImagesToDelete" value="@image.Id" id="img_@image.Id" class="form-check-input position-absolute top-0 end-0 m-2" />
                                    <label for="img_@image.Id" class="d-block">
                                        <img src="@image.FilePath" alt="@image.FileName" class="img-fluid rounded" style="max-height: 150px; object-fit: cover; width: 100%; cursor: pointer; opacity: 0.7;" />
                                    </label>
                                    <small class="text-muted d-block text-center">Sil</small>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            <div class="mb-3">
                <label for="NewImages" class="form-label">Yeni Fotoğraflar Ekle</label>
                <input type="file" class="form-control" id="NewImages" name="NewImages" multiple accept="image/*" />
                <small class="form-text text-muted">Birden fazla fotoğraf seçebilirsiniz.</small>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-am-primary">Kaydet</button>
                <a asp-action="Detail" asp-route-id="@request.Id" class="btn btn-secondary">İptal</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
